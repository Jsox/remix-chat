generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int           @id @default(autoincrement())
  email        String?       @unique
  name         String?
  avatar       String?
  fingerprint  String        @unique
  isAdmin      Boolean?      @default(false)
  phone        String?       @unique
  tokens       Int?          @default(1000)
  password     String?
  chatMessages ChatMessage[]

  @@index([fingerprint, id])
}

model ChatMessage {
  id               Int           @id @default(autoincrement())
  userId           Int
  messageBy        MessageAuthor
  created          DateTime
  promptTokens     Int?
  completionTokens Int?
  totalTokens      Int?
  messageId        String        @unique
  conversationId   String?
  parentMessageId  String?
  model            String?
  text             String
  user             User          @relation(fields: [userId], references: [id])

  @@index([messageId, conversationId])
  @@index([userId], map: "ChatMessage_userId_fkey")
}

enum MessageAuthor {
  User
  AI
}
